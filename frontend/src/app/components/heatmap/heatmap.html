<div @fadeIn>
  <!-- Header Section with Enhanced Design -->
  <div class="flex flex-col md:flex-row items-center justify-between mb-8 gap-6">
    <!-- Year Navigation with Modern Style -->
    <div class="flex items-center gap-4 bg-base-200/50 rounded-2xl p-3 border border-base-300/30 backdrop-blur-sm">
      <button
        class="btn btn-circle btn-ghost hover:bg-primary/10 hover:text-primary hover:scale-110 transition-all duration-300"
        (click)="previousYear()" [disabled]="loading">
        <ng-icon name="heroChevronLeft" size="24"></ng-icon>
      </button>

      <div class="flex items-center gap-2 px-4">
        <ng-icon name="heroCalendarDays" size="20" class="text-primary"></ng-icon>
        <span class="text-3xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">{{
          currentYear }}</span>
      </div>

      <button
        class="btn btn-circle btn-ghost hover:bg-primary/10 hover:text-primary hover:scale-110 transition-all duration-300"
        (click)="nextYear()" [disabled]="loading">
        <ng-icon name="heroChevronRight" size="24"></ng-icon>
      </button>
    </div>

    <!-- Streak Info (New Feature) -->
    <div
      class="flex items-center gap-3 bg-gradient-to-r from-accent/10 to-secondary/10 rounded-2xl px-6 py-3 border border-accent/20">
      <ng-icon name="heroFire" size="24" class="text-accent"></ng-icon>
      <div class="flex flex-col">
        <span class="text-2xl font-bold text-accent">{{ currentStreak }}</span>
        <span class="text-xs text-base-content/60">Day Streak</span>
      </div>
    </div>
  </div>

  <!-- Stats Section with Enhanced Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8" *ngIf="!loading" @fadeIn>
    <!-- Total Pages Card -->
    <div
      class="group relative overflow-hidden rounded-2xl bg-base-100/40 backdrop-blur-md border border-primary/20 p-6 hover:border-primary/50 transition-all duration-500 hover:shadow-lg hover:shadow-primary/20 hover:-translate-y-1">
      <div
        class="absolute inset-0 bg-gradient-to-br from-primary/10 via-primary/5 to-transparent opacity-60 group-hover:opacity-100 transition-opacity duration-500">
      </div>
      <div
        class="absolute -right-6 -top-6 w-32 h-32 bg-primary/20 rounded-full blur-3xl group-hover:bg-primary/30 transition-all duration-500">
      </div>
      <div class="relative">
        <div class="flex items-center gap-2 mb-2">
          <div
            class="p-2 rounded-lg bg-primary/10 text-primary group-hover:scale-110 transition-transform duration-300">
            <ng-icon name="heroBookOpen" size="20"></ng-icon>
          </div>
          <div class="text-xs font-bold text-base-content/60 uppercase tracking-wider">Total Pages</div>
        </div>
        <div class="text-4xl font-black text-base-content group-hover:text-primary transition-colors duration-300">{{
          totalPages | number }}</div>
      </div>
    </div>

    <!-- Active Days Card -->
    <div
      class="group relative overflow-hidden rounded-2xl bg-base-100/40 backdrop-blur-md border border-secondary/20 p-6 hover:border-secondary/50 transition-all duration-500 hover:shadow-lg hover:shadow-secondary/20 hover:-translate-y-1">
      <div
        class="absolute inset-0 bg-gradient-to-br from-secondary/10 via-secondary/5 to-transparent opacity-60 group-hover:opacity-100 transition-opacity duration-500">
      </div>
      <div
        class="absolute -right-6 -top-6 w-32 h-32 bg-secondary/20 rounded-full blur-3xl group-hover:bg-secondary/30 transition-all duration-500">
      </div>
      <div class="relative">
        <div class="flex items-center gap-2 mb-2">
          <div
            class="p-2 rounded-lg bg-secondary/10 text-secondary group-hover:scale-110 transition-transform duration-300">
            <ng-icon name="heroCalendarDays" size="20"></ng-icon>
          </div>
          <div class="text-xs font-bold text-base-content/60 uppercase tracking-wider">Active Days</div>
        </div>
        <div class="text-4xl font-black text-base-content group-hover:text-secondary transition-colors duration-300">{{
          totalDays }}</div>
      </div>
    </div>

    <!-- Average Pages/Day Card -->
    <div
      class="group relative overflow-hidden rounded-2xl bg-base-100/40 backdrop-blur-md border border-accent/20 p-6 hover:border-accent/50 transition-all duration-500 hover:shadow-lg hover:shadow-accent/20 hover:-translate-y-1">
      <div
        class="absolute inset-0 bg-gradient-to-br from-accent/10 via-accent/5 to-transparent opacity-60 group-hover:opacity-100 transition-opacity duration-500">
      </div>
      <div
        class="absolute -right-6 -top-6 w-32 h-32 bg-accent/20 rounded-full blur-3xl group-hover:bg-accent/30 transition-all duration-500">
      </div>
      <div class="relative">
        <div class="flex items-center gap-2 mb-2">
          <div class="p-2 rounded-lg bg-accent/10 text-accent group-hover:scale-110 transition-transform duration-300">
            <ng-icon name="heroChartBarSquare" size="20"></ng-icon>
          </div>
          <div class="text-xs font-bold text-base-content/60 uppercase tracking-wider">Avg Pages/Day</div>
        </div>
        <div class="text-4xl font-black text-base-content group-hover:text-accent transition-colors duration-300">{{
          totalPages > 0 ? (totalPages / totalDays | number:'1.0-0') : 0 }}</div>
      </div>
    </div>

    <!-- Longest Streak Card -->
    <div
      class="group relative overflow-hidden rounded-2xl bg-base-100/40 backdrop-blur-md border border-warning/20 p-6 hover:border-warning/50 transition-all duration-500 hover:shadow-lg hover:shadow-warning/20 hover:-translate-y-1">
      <div
        class="absolute inset-0 bg-gradient-to-br from-warning/10 via-warning/5 to-transparent opacity-60 group-hover:opacity-100 transition-opacity duration-500">
      </div>
      <div
        class="absolute -right-6 -top-6 w-32 h-32 bg-warning/20 rounded-full blur-3xl group-hover:bg-warning/30 transition-all duration-500">
      </div>
      <div class="relative">
        <div class="flex items-center gap-2 mb-2">
          <div
            class="p-2 rounded-lg bg-warning/10 text-warning group-hover:scale-110 transition-transform duration-300">
            <ng-icon name="heroTrophy" size="20"></ng-icon>
          </div>
          <div class="text-xs font-bold text-base-content/60 uppercase tracking-wider">Best Streak</div>
        </div>
        <div class="text-4xl font-black text-base-content group-hover:text-warning transition-colors duration-300">{{
          longestStreak }}</div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex flex-col items-center justify-center py-20">
    <span class="loading loading-spinner loading-lg text-primary"></span>
    <p class="mt-4 text-base-content/70">Loading your reading data...</p>
  </div>

  <!-- Calendar Grid with Modern Design -->
  <div *ngIf="!loading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8" @staggerFade>
    <div class="month-container group relative rounded-2xl p-5 flex flex-col h-full min-h-[320px]"
      *ngFor="let month of calendarMonths; let i = index" (mouseenter)="setHoveredMonth(i)"
      (mouseleave)="clearHoveredMonth()" [class.z-50]="hoveredMonth === i">
      <!-- Month Header with Icon -->
      <div class="flex items-center justify-center gap-2 mb-4">
        <h3
          class="text-center font-bold text-xl text-base-content group-hover:text-primary transition-colors duration-300">
          {{ month.monthName }}</h3>
      </div>

      <!-- Day Headers -->
      <div class="grid grid-cols-7 text-center mb-3 text-xs font-bold opacity-50">
        <div class="p-1">S</div>
        <div class="p-1">M</div>
        <div class="p-1">T</div>
        <div class="p-1">W</div>
        <div class="p-1">T</div>
        <div class="p-1">F</div>
        <div class="p-1">S</div>
      </div>

      <!-- Calendar Days -->
      <div class="flex flex-col gap-1.5 flex-grow">
        <div class="grid grid-cols-7 gap-1.5" *ngFor="let week of month.weeks">
          <div class="day-cell" *ngFor="let day of week.days" [class.current-month]="day.isCurrentMonth"
            [class.other-month]="!day.isCurrentMonth" [class.today]="isToday(day.date)"
            [ngClass]="getDayClass(day.pagesRead)" [attr.data-tooltip]="getTooltipText(day)">
            <span *ngIf="day.isCurrentMonth" class="day-number">{{ day.dayOfMonth }}</span>
          </div>
        </div>
      </div>

      <!-- Month Summary -->
      <div
        class="mt-auto pt-4 border-t border-base-content/5 flex items-center justify-between text-xs opacity-70 group-hover:opacity-100 transition-opacity duration-300">
        <div class="flex items-center gap-1">
          <ng-icon name="heroBookOpen" size="14" class="text-primary"></ng-icon>
          <span class="font-semibold">{{ getMonthTotal(month) }} pages</span>
        </div>
        <div class="flex items-center gap-1">
          <ng-icon name="heroFire" size="14" class="text-secondary"></ng-icon>
          <span class="font-semibold">{{ getMonthActiveDays(month) }} days</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Legend with Modern Design -->
  <div class="relative overflow-hidden rounded-2xl bg-base-100/40 backdrop-blur-md border border-base-300/50 p-6"
    *ngIf="!loading" @fadeIn>
    <div class="absolute top-0 right-0 w-64 h-64 bg-primary/5 rounded-full blur-3xl"></div>
    <div class="relative">
      <div class="flex items-center gap-3 mb-6">
        <div class="p-2 rounded-lg bg-primary/10 text-primary">
          <ng-icon name="heroSparkles" size="20"></ng-icon>
        </div>
        <div>
          <h3 class="text-lg font-bold">Activity Level Guide</h3>
          <p class="text-xs text-base-content/60">Track your reading intensity throughout the year</p>
        </div>
      </div>

      <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
        <div
          class="group flex items-center gap-3 p-3 rounded-xl bg-base-100/50 hover:bg-base-100 border border-base-300/30 hover:border-primary/30 transition-all duration-300 hover:scale-105 hover:shadow-lg"
          *ngFor="let item of legendItems">
          <div
            class="w-8 h-8 rounded-lg flex-shrink-0 ring-2 ring-base-300/30 group-hover:ring-primary/30 transition-all duration-300"
            [ngClass]="item.className"></div>
          <div class="flex flex-col">
            <div class="text-sm font-bold">{{ item.label }}</div>
            <div class="text-xs text-base-content/50">{{ item.range }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>